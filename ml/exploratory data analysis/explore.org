;-*- mode: Org; fill-column: 110;-*-
* users
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

def csv_file_read(p):
    df = pd.read_csv(p, index_col=False, low_memory=False)
    return df

p = '/home/u/proj_dolgoletie/users.csv'
df = csv_file_read(p)
print(df.columns)
print(df.describe().to_string())
df.set_index(df.columns[0], inplace=True)
print()
print(df.describe().to_string())
print()
print(df.isna().sum())
#+end_src

#+RESULTS:
#+begin_example
Index(['уникальный номер', 'дата создание личного дела', 'пол',
       'дата рождения', 'адрес проживания'],
      dtype='object')
       уникальный номер
count      5.233400e+04
mean       1.013990e+08
std        3.020764e+04
min        1.013465e+08
25%        1.013730e+08
50%        1.013990e+08
75%        1.014253e+08
max        1.014512e+08

       дата создание личного дела      пол дата рождения                                 адрес проживания
count                       52334    52334         52334                                            52334
unique                      52270        2         11013                                            33337
top       2019-03-06 00:00:00.000  Женщина    1957-01-01  город москва, каширское шоссе, дом 59, корпус 1
freq                            3    47181            28                                               15

дата создание личного дела    0
пол                           0
дата рождения                 0
адрес проживания              0
dtype: int64
#+end_example

#+name: wt
#+header: :prologue from tabulate import tabulate
#+begin_src python :results value raw :exports both :session s1
def pd2org(df_to_table):
    return tabulate(df_to_table, headers=df_to_table.columns, tablefmt='orgtbl')

pd2org(df.head())
#+end_src

#+RESULTS: wt
|           | направление 1         | направление 2 | направление 3 | адрес площадки                                                                                                                                                                                                                                 | округ площадки                                                                                                                                                      | район площадки                                                                                                                                                                                    | расписание в активных периодах | расписание в закрытых периодах                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | расписание в плановом периоде |
|-----------+-----------------------+---------------+---------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------|
| 801357270 | Физическая активность | ОФП           | ОФП           | город Москва, Саратовская улица, дом 16, корпус 2                                                                                                                                                                                              | Юго-Восточный административный округ                                                                                                                                | муниципальный округ Текстильщики                                                                                                                                                                  |                            nan | c 01.01.2023 по 31.03.2023, Пн., Ср. 19:10-20:10, без перерыва; c 18.04.2022 по 31.12.2022, Пн., Ср. 19:10-20:10, без перерыва; c 20.09.2019 по 31.12.2019, Пн., Ср. 19:00-20:00, без перерыва; c 13.01.2020 по 14.02.2020, Пн., Ср. 19:00-20:00, без перерыва; c 15.02.2020 по 31.12.2020, Пн., Ср. 19:30-20:30, без перерыва                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                           nan |
| 801356857 | Физическая активность | ОФП           | ОФП           | город Москва, Подольская улица, дом 5                                                                                                                                                                                                          | Юго-Восточный административный округ                                                                                                                                | муниципальный округ Марьино                                                                                                                                                                       |                            nan | c 09.01.2023 по 31.03.2023, Вт., Чт. 10:00-11:00, без перерыва; c 18.10.2022 по 31.12.2022, Вт., Чт. 10:00-11:00, без перерыва; c 05.04.2022 по 17.10.2022, Чт. 11:00-12:00, без перерыва, Вт. 10:00-11:00, без перерыва; c 11.01.2021 по 31.12.2021, Вт., Чт. 12:00-13:00, без перерыва; c 10.09.2019 по 31.12.2019, Вт., Чт. 12:00-13:00, без перерыва; c 14.01.2020 по 31.12.2020, Вт., Чт. 12:00-13:00, без перерыва                                                                                                                                                                                                                                                                                                                                                                                     |                           nan |
| 801351684 | Физическая активность | ОФП           | ОФП           | г. Москва, Базовская улица, дом 15, строение 13, город Москва, Ангарская улица, дом 22А, г. Москва, Талдомская улица, дом 13, корпус А, город Москва, Базовская улица, дом 20А, строение 2, город Москва, Базовская улица, дом 20А, строение 2 | Северный административный округ, Северный административный округ, Северный административный округ, Северный административный округ, Северный административный округ | муниципальный округ Западное Дегунино, муниципальный округ Западное Дегунино, муниципальный округ Западное Дегунино, муниципальный округ Западное Дегунино, муниципальный округ Западное Дегунино |                            nan | c 09.01.2023 по 31.03.2023, Вт., Чт. 19:00-20:00, без перерыва; c 06.10.2022 по 31.12.2022, Вт., Чт. 19:00-20:00, без перерыва; c 02.09.2022 по 05.10.2022, Вт., Чт. 18:30-19:30, без перерыва; c 10.01.2022 по 01.09.2022, Пн., Ср. 13:30-14:30, без перерыва; c 22.11.2021 по 31.12.2021, Пн., Ср. 13:30-14:30, без перерыва; c 12.08.2021 по 21.11.2021, Пн., Ср. 15:30-16:30, без перерыва; c 11.01.2021 по 11.08.2021, Пн., Ср. 16:00-17:00, без перерыва; c 04.09.2019 по 31.12.2019, Ср. 19:00-20:00, без перерыва, Пт. 18:00-19:00, без перерыва; c 13.01.2020 по 13.02.2020, Ср. 19:00-20:00, без перерыва, Пт. 18:00-19:00, без перерыва; c 14.02.2020 по 09.08.2020, Ср. 19:00-20:00, без перерыва, Пт. 18:00-19:00, без перерыва; c 10.08.2020 по 31.12.2020, Пн., Ср. 16:00-17:00, без перерыва |                           nan |
| 801353683 | Физическая активность | ОФП           | ОФП           | город Москва, улица Обручева, дом 28А, город Москва, улица Обручева, дом 28А                                                                                                                                                                   | Юго-Западный административный округ, Юго-Западный административный округ                                                                                            | муниципальный округ Обручевский, муниципальный округ Обручевский                                                                                                                                  |                            nan | c 09.01.2023 по 31.03.2023, Пн., Ср. 13:30-14:30, без перерыва; c 17.03.2022 по 23.09.2022, Чт. 16:30-17:30, без перерыва; c 21.03.2022 по 23.09.2022, Пн. 15:30-16:30, без перерыва; c 26.09.2022 по 31.12.2022, Пн., Ср. 13:30-14:30, без перерыва; c 01.10.2020 по 31.12.2020, Пн., Ср. 15:30-16:30, без перерыва; c 13.01.2020 по 30.09.2020, Пн., Ср. 15:30-16:30, без перерыва; c 16.09.2019 по 31.12.2019, Пн., Ср. 15:30-16:30, без перерыва                                                                                                                                                                                                                                                                                                                                                         |                           nan |
| 801352164 | Физическая активность | ОФП           | ОФП           | город Москва, Воронцовский парк, дом 3, город Москва, Воронцовский парк, дом 3                                                                                                                                                                 | Юго-Западный административный округ, Юго-Западный административный округ                                                                                            | муниципальный округ Обручевский, муниципальный округ Обручевский                                                                                                                                  |                            nan | c 10.01.2023 по 28.02.2023, Вт., Пт. 12:00-13:00, без перерыва; c 02.09.2022 по 31.12.2022, Вт., Пт. 12:00-13:00, без перерыва; c 03.06.2022 по 31.08.2022, Вт., Чт. 11:00-12:00, без перерыва; c 05.04.2022 по 03.06.2022, Вт., Чт. 10:00-11:00, без перерыва; c 11.01.2022 по 04.04.2022, Вт., Чт. 11:00-12:00, без перерыва; c 01.09.2021 по 31.12.2021, Вт., Чт. 11:00-12:00, без перерыва; c 03.08.2021 по 31.08.2021, Вт., Чт. 12:00-13:00, без перерыва; c 04.02.2019 по 31.12.2019, Пн., Чт. 10:00-11:00, без перерыва; c 13.01.2020 по 22.07.2020, Пн., Чт. 10:00-11:00, без перерыва; c 01.08.2020 по 31.12.2020, Пн., Чт. 10:00-11:00, без перерыва                                                                                                                                               |                           nan |

#+RESULTS:

# #+begin_src python :results file graphics :exports both :file ./autoimgs/users_scat.png :session s1
# import matplotlib.pyplot as plt
# fig = plt.figure(figsize=(9, 2))
# ax1 = fig.add_subplot(141) # matplotlib.axes._subplots.AxesSubplot
# ax2 = fig.add_subplot(142)
# ax3 = fig.add_subplot(143)
# ax1.boxplot(df['acidity'])
# ax1.set_title('acidity')
# plt.savefig('./autoimgs/users_scat.png')
# #+end_src

* groups
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

def csv_file_read(p):
    df = pd.read_csv(p, index_col=False, low_memory=False)
    return df

p = '/home/u/proj_dolgoletie/groups.csv'
df = csv_file_read(p)
print(df.columns)
print(df.describe().to_string())
df.set_index(df.columns[0], inplace=True)
print(df.describe().to_string())
print()
print(df.isna().sum())
#+end_src

#+RESULTS:
#+begin_example
Index(['уникальный номер', 'направление 1', 'направление 2', 'направление 3',
       'адрес площадки', 'округ площадки', 'район площадки',
       'расписание в активных периодах', 'расписание в закрытых периодах',
       'расписание в плановом периоде'],
      dtype='object')
       уникальный номер
count      2.700300e+04
mean       8.013602e+08
std        7.885366e+03
min        8.013465e+08
25%        8.013533e+08
50%        8.013602e+08
75%        8.013670e+08
max        8.013739e+08
       направление 1 направление 2                   направление 3                                             адрес площадки                    округ площадки               район площадки                                  расписание в активных периодах                                  расписание в закрытых периодах                              расписание в плановом периоде
count          27003         27003                           27003                                                      27003                             23021                        23021                                                            6522                                                           21643                                                         67
unique            12            81                             456                                                       4821                               139                          685                                                            4458                                                           19959                                                         62
top      Образование    Гимнастика  Осваиваем мобильные устройства  г. Москва, поселение Сосенское, деревня Зименки, дом. 13.  Восточный административный округ  муниципальный округ Ясенево  c 09.01.2023 по 31.12.2023, Пн., Ср. 09:00-10:00, без перерыва  c 11.01.2022 по 31.12.2022, Вт., Чт. 09:00-10:00, без перерыва  c 29.04.2023 по 30.04.2023, Вс. 11:00-12:00, без перерыва
freq            9502          3048                             890                                                        412                              2915                          449                                                              35                                                              18                                                          3

направление 1                         0
направление 2                         0
направление 3                         0
адрес площадки                        0
округ площадки                     3982
район площадки                     3982
расписание в активных периодах    20481
расписание в закрытых периодах     5360
расписание в плановом периоде     26936
dtype: int64
#+end_example

#+name: wt2
#+header: :prologue from tabulate import tabulate
#+begin_src python :results value raw :exports both :session s1
def pd2org(df_to_table):
    return tabulate(df_to_table, headers=df_to_table.columns, tablefmt='orgtbl')

pd2org(df.sample(7))
#+end_src

#+RESULTS: wt2
|           | направление 1         | направление 2                    | направление 3                         | адрес площадки                                                                       | округ площадки                        | район площадки                      |                                                           расписание в активных периодах | расписание в закрытых периодах                                                                                                 |                                                            расписание в плановом периоде |
|-----------+-----------------------+----------------------------------+---------------------------------------+--------------------------------------------------------------------------------------+---------------------------------------+-------------------------------------+------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------|
| 801347690 | Физическая активность | ОНЛАЙН Гимнастика                | ОНЛАЙН Суставная гимнастика           | г. Москва, Жулебинский бульвар, дом 40, корпус 1                                     | Юго-Восточный административный округ  | муниципальный округ Выхино-Жулебино |                                                                                      nan | c 10.01.2023 по 31.03.2023, Вт., Чт. 16:50-17:50, без перерыва; c 18.01.2022 по 31.12.2022, Вт., Чт. 16:50-17:50, без перерыва |                                                                                      nan |
| 801350454 | Рисование             | Рисование                        | Рисование анти-стресс                 | г. Москва, квартал Волжский Бульвар 114а, корпус 6                                   | Юго-Восточный административный округ  | муниципальный округ Кузьминки       |                                                                                      nan | c 15.06.2022 по 20.10.2022, Пт. 12:00-14:00, без перерыва, Ср. 10:00-12:00, без перерыва                                       |                                                                                      nan |
| 801369743 | Образование           | ОНЛАЙН Информационные технологии | ОНЛАЙН Осваиваем мобильные устройства | г. Москва, Борисовский проезд, д.10, корп.1, кв.55                                   | nan                                   | nan                                 | c 07.01.2023 по 30.04.2023, Сб. 09:30-11:30, без перерыва, Пн. 17:30-19:30, без перерыва | nan                                                                                                                            | c 01.05.2023 по 31.12.2023, Сб. 09:30-11:30, без перерыва, Чт. 15:00-17:00, без перерыва |
| 801354462 | Физическая активность | Фитнес, тренажеры                | Фитнес                                | город Москва, Кавказский бульвар, дом 12, корпус 3                                   | Южный административный округ          | муниципальный округ Царицыно        |                                                                                      nan | c 05.04.2022 по 25.12.2022, Вт., Чт. 10:00-11:00, без перерыва                                                                 |                                                                                      nan |
| 801364430 | Танцы                 | Танцы                            | Танцы для всех                        | город Москва, город Зеленоград, Центральная площадь, дом 1                           | Зеленоградский административный округ | муниципальное образование Савелки   |                           c 02.03.2023 по 31.12.2023, Вт., Чт. 09:40-10:40, без перерыва | nan                                                                                                                            |                                                                                      nan |
| 801349173 | Образование           | Пеший лекторий                   | Краеведение и пешие прогулки          | г. Москва, Карельский бульвар, дом 23, корпус 2                                      | Северный административный округ       | муниципальный округ Дмитровский     |                                                                                      nan | c 22.06.2022 по 31.12.2022, Ср. 11:30-13:30, без перерыва                                                                      |                                                                                      nan |
| 801365079 | Рисование             | ОНЛАЙН Рисование                 | ОНЛАЙН Рисование анти-стресс          | город Санкт-Петербург, Северный проспект, дом 91, корпус 4, литера А, квартира 82.5. | nan                                   | nan                                 | c 11.01.2023 по 31.12.2023, Ср. 14:30-16:30, без перерыва, Пт. 12:00-14:00, без перерыва | nan                                                                                                                            |                                                                                      nan |

* attend
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

def csv_file_read(p):
    df = pd.read_csv(p, index_col=False, low_memory=False)
    return df

p = '/home/u/proj_dolgoletie/attend.csv'
df = csv_file_read(p)
print(df.head())
df.sample(1000).to_csv('/home/u/proj_dolgoletie/attend_s.csv', index=False)
print(df.columns)
print(df.describe().to_string())
print()
print(df.isna().sum())
#+end_src

#+RESULTS:
#+begin_example
   уникальный номер занятия  уникальный номер группы  ...  время начала занятия время окончания занятия
0                 401346550                801346550  ...              09:00:00                10:00:00
1                 401346550                801346550  ...              09:00:00                10:00:00
2                 401346550                801346550  ...              09:00:00                10:00:00
3                 401346550                801346550  ...              09:00:00                10:00:00
4                 401346550                801346550  ...              09:00:00                10:00:00

[5 rows x 9 columns]
Index(['уникальный номер занятия', 'уникальный номер группы',
       'уникальный номер участника', 'направление 2', 'направление 3',
       'онлайн/офлайн', 'дата занятия', 'время начала занятия',
       'время окончания занятия'],
      dtype='object')
       уникальный номер занятия  уникальный номер группы  уникальный номер участника
count              5.901274e+06             5.901274e+06                5.901274e+06
mean               4.017303e+08             8.013542e+08                1.013913e+08
std                2.363223e+05             7.097297e+03                2.703652e+04
min                4.013466e+08             8.013465e+08                1.013465e+08
25%                4.015109e+08             8.013489e+08                1.013676e+08
50%                4.017740e+08             8.013515e+08                1.013901e+08
75%                4.019486e+08             8.013579e+08                1.014152e+08
max                4.021031e+08             8.013739e+08                1.014495e+08

уникальный номер занятия      0
уникальный номер группы       0
уникальный номер участника    0
направление 2                 0
направление 3                 0
онлайн/офлайн                 0
дата занятия                  0
время начала занятия          0
время окончания занятия       0
dtype: int64
#+end_example

#+begin_src python :results output :exports both :session s1
cols = df.select_dtypes(include="object").columns.tolist()
print(df[cols].describe().to_string())
#+end_src

#+RESULTS:
:             направление 2                                            направление 3 онлайн/офлайн дата занятия время начала занятия время окончания занятия
: count             5901274                                                  5901274       5901274      5901274              5901274                 5901274
: unique                 81                                                      453             2          333                  157                     156
: top     ОНЛАЙН Гимнастика  ОНЛАЙН Мастер-класс по уходу за кожей в зрелом возрасте            Да   2023-02-14             10:00:00                11:00:00
: freq               819496                                                   413095       3816929        39308               658684                  599741

#+name: attend
#+header: :prologue from tabulate import tabulate
#+begin_src python :results value raw :exports both :session s1
def pd2org(df_to_table):
    return tabulate(df_to_table, headers=df_to_table.columns, tablefmt='orgtbl')

pd2org(df.sample(7))
#+end_src

#+RESULTS: attend
|         | уникальный номер занятия | уникальный номер группы | уникальный номер участника | направление 2                          | направление 3                     | онлайн/офлайн | дата занятия | время начала занятия | время окончания занятия |
|---------+--------------------------+-------------------------+----------------------------+----------------------------------------+-----------------------------------+---------------+--------------+----------------------+-------------------------|
| 5671855 |                402081657 |               801346957 |                  101364335 | ОНЛАЙН История, искусство, краеведение | ОНЛАЙН История искусства          | Да            |   2023-01-30 |             16:15:00 |                18:15:00 |
| 2045190 |                401573152 |               801356660 |                  101378922 | Спортивные игры                        | Настольный теннис                 | Нет           |   2022-06-09 |             13:00:00 |                14:00:00 |
| 2335478 |                401608749 |               801348723 |                  101385095 | ОНЛАЙН Иностранные языки               | ОНЛАЙН Французский язык           | Да            |   2022-06-09 |             10:30:00 |                11:30:00 |
| 5289570 |                402038657 |               801366880 |                  101369874 | ОНЛАЙН Гимнастика                      | ОНЛАЙН Оздоровительная гимнастика | Да            |   2023-02-28 |             10:00:00 |                11:00:00 |
| 3156968 |                401798744 |               801354409 |                  101407130 | Спортивные игры                        | Волейбол                          | Нет           |   2022-11-25 |             17:00:00 |                19:00:00 |
|  378241 |                401388957 |               801352922 |                  101347379 | Пеший лекторий                         | Краеведение и пешие прогулки      | Нет           |   2022-08-08 |             11:00:00 |                13:00:00 |
| 3764319 |                401868310 |               801351317 |                  101409686 | ОНЛАЙН Здорово жить                    | ОНЛАЙН Правильное питание         | Да            |   2022-10-20 |             12:00:00 |                14:00:00 |

* dict
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

def csv_file_read(p):
    df = pd.read_csv(p, index_col=False, low_memory=False)
    return df

p = '/home/u/proj_dolgoletie/dict.csv'
df = csv_file_read(p)
print(df.columns)
print(df.describe().to_string())
cols = df.select_dtypes(include="object").columns.tolist()
print(df[cols].describe().to_string())
print()
print(df.isna().sum())
#+end_src

#+RESULTS:
#+begin_example
Index(['Разметка: Для ума/ Для души / Для тела', 'id_level1', 'level1',
       'id_level2', 'level2', 'id_level3', 'leve3', 'd_level1', 'd_level2',
       'd_level3'],
      dtype='object')
         id_level1    id_level2    id_level3  d_level2  d_level3
count   899.000000   899.000000   899.000000       0.0       0.0
mean   1013.157953  1096.121246  1207.208009       NaN       NaN
std     425.207139   335.171900   496.859270       NaN       NaN
min     589.000000   588.000000   101.000000       NaN       NaN
25%     627.000000   650.000000  1097.500000       NaN       NaN
50%     649.000000  1076.000000  1329.000000       NaN       NaN
75%    1476.000000  1479.000000  1583.500000       NaN       NaN
max    1731.000000  1794.000000  1814.000000       NaN       NaN
       Разметка: Для ума/ Для души / Для тела                              level1                               level2                      leve3                                                                                    d_level1
count                                     899                                 899                                  899                        899                                                                                         899
unique                                      3                                  11                                   83                        872                                                                                         720
top                                   Для ума  Спецпроект / Интеллектуальный клуб  Художественно-прикладное творчество  ОНЛАЙН Ландшафтный дизайн  Занятия по изучению лексики и грамматики английского языка с помощью чтения и аудирования.
freq                                      511                                 405                                   30                          2                                                                                           4

Разметка: Для ума/ Для души / Для тела      0
id_level1                                   0
level1                                      0
id_level2                                   0
level2                                      0
id_level3                                   0
leve3                                       0
d_level1                                    0
d_level2                                  899
d_level3                                  899
dtype: int64
#+end_example

#+begin_src python :results output :exports both :session s1
cols = df.select_dtypes(include="object").columns.tolist()
print(df[cols].describe().to_string())
#+end_src

#+RESULTS:
:        Разметка: Для ума/ Для души / Для тела                              level1                               level2                      leve3                                                                                    d_level1
: count                                     899                                 899                                  899                        899                                                                                         899
: unique                                      3                                  11                                   83                        872                                                                                         720
: top                                   Для ума  Спецпроект / Интеллектуальный клуб  Художественно-прикладное творчество  ОНЛАЙН Ландшафтный дизайн  Занятия по изучению лексики и грамматики английского языка с помощью чтения и аудирования.
: freq                                      511                                 405                                   30                          2                                                                                           4

#+name: dict
#+header: :prologue from tabulate import tabulate
#+begin_src python :results value raw :exports both :session s1
def pd2org(df_to_table):
    return tabulate(df_to_table, headers=df_to_table.columns, tablefmt='orgtbl')

pd2org(df.sample(7))
#+end_src

#+RESULTS: dict
|     | Разметка: Для ума/ Для души / Для тела | id_level1 | level1                             | id_level2 | level2                                          | id_level3 | leve3                                                         | d_level1                                                                                                                                                                                                                                                                                              | d_level2 | d_level3 |
|-----+----------------------------------------+-----------+------------------------------------+-----------+-------------------------------------------------+-----------+---------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+----------|
| 257 | Для ума                                |      1476 | Спецпроект / Интеллектуальный клуб |      1483 | Интеллектуальный клуб. Здоровье/красота/стиль   |      1571 | Лекарственные растения                                        | Занятия по изучению свойств лекарственных растений для эффективной помощи в восстановлении здоровья.                                                                                                                                                                                                  |      nan |      nan |
| 225 | Для души                               |       629 | Рисование                          |       628 | Рисование                                       |       460 | Китайская живопись У-Син                                      | Занятия по изучению современной традиционной китайской техники рисования тушью по методу создания рисунка «одним движением».                                                                                                                                                                          |      nan |      nan |
| 695 | Для души                               |       625 | Танцы                              |       624 | Танцы                                           |       182 | Исторические танцы                                            | Занятия по изучению основных движений и связок в танцах прошлых эпох.                                                                                                                                                                                                                                 |      nan |      nan |
| 193 | Для ума                                |       631 | Образование                        |       636 | Психология и коммуникации                       |       206 | Психологические тренинги                                      | Занятия по изучению навыков поведения и развития личности с помощью практических психологических упражнений и разных форм взаимодействия.                                                                                                                                                             |      nan |      nan |
| 896 | Для тела                               |       589 | Физическая активность              |       592 | Фитнес, тренажеры                               |       129 | Фитнес                                                        | Занятия по изучению упражнений, направленных на тренировку сердечно-сосудистой системы, развитие силы, гибкости и выносливости.                                                                                                                                                                       |      nan |      nan |
| 465 | Для ума                                |      1476 | Спецпроект / Интеллектуальный клуб |      1078 | ОНЛАЙН Интеллектуальный клуб. Иностранные языки |      1275 | ОНЛАЙН Испанский язык для общения и путешествий. Базовый курс | В рамках программы участники, обладающие базовыми знаниями в области испанского языка, смогут развить навыки говорения, письма, аудирования и чтения на уровне А1.1 по общеевропейской шкале владения испанским языком. (К занятиям допускаются участники прошедшие Вводный курс данного направления) |      nan |      nan |
|  47 | Для ума                                |       631 | Образование                        |       630 | Информационные технологии                       |       136 | Курсы компьютерной грамотности                                | Занятия по изучению навыков работы на компьютере и знакомство с основными компьютерными программами и интернет-сервисами.                                                                                                                                                                             |      nan |      nan |

* test
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

def csv_file_read(p):
    df = pd.read_csv(p, index_col=False, low_memory=False)
    return df

p = '/home/u/proj_dolgoletie/test.csv'
df = csv_file_read(p)
print(df.describe().to_string())
print(df.sample(7))
#+end_src

#+RESULTS:
#+begin_example
       уникальный номер участника  уникальный номер группы
count                2.000000e+02                      0.0
mean                 1.013928e+08                      NaN
std                  2.944838e+04                      NaN
min                  1.013466e+08                      NaN
25%                  1.013675e+08                      NaN
50%                  1.013893e+08                      NaN
75%                  1.014192e+08                      NaN
max                  1.014496e+08                      NaN
     уникальный номер участника  уникальный номер группы
51                    101367595                      NaN
101                   101390346                      NaN
133                   101408981                      NaN
169                   101428953                      NaN
60                    101369257                      NaN
151                   101420015                      NaN
93                    101386108                      NaN
#+end_example

* test -> attend
Вывод только 3 пользователя из 200 нет в таблице atten.

Большинство пользователей имеют в среднем 8-15 групп

** load
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

p = '/home/u/proj_dolgoletie/attend.csv'
dfa = pd.read_csv(p, header=0, index_col=False, low_memory=True,
                  names=['unknown_id', 'group_id', 'users_id', 'dict2', 'dict3', 'o1f', 'date', 'time_beg', 'time_end'])
p = '/home/u/proj_dolgoletie/groups.csv'
dfg = pd.read_csv(p, header=0, index_col=False, low_memory=False,
                  names=['id', 'dict1', 'dict2', 'dict3', 'p_addr', 'p_okr', 'p_ra', 'shed_act', 'shed_closed', 'shed_plan'])
p = '/home/u/proj_dolgoletie/test.csv'
dft = pd.read_csv(p, header=0, index_col=False, low_memory=False,
                  names=['users_id', 'group_id'])
def count_fkey(key1, key2):
    "we get unique of key1 and compare with all key2"
    un1 = np.unique(key1)
    # un2 = np.unique(key2)
    un2 = key2
    cm = np.in1d(un1, un2, assume_unique=True)
    if 'name' in dir(key1):
        print(f"Unique [{key1.name}]: { un1.size}")
        print(f"Unique [{key2.name}]: { un2.size}")
    else:
        print(f"key1: { un1.size}")
        print(f"key2: { un2.size}")
    c = np.unique(cm, return_counts=True)
    print(pd.DataFrame({'values':c[0], 'count':c[1]}))
#+end_src

#+RESULTS:

** Пользователей с attend

#+begin_src python :results output :exports both :session s1
print(count_fkey(dft.users_id, dfa.users_id))
#+end_src

#+RESULTS:
: Unique [users_id]: 200
: Unique [users_id]: 5901274
:    values  count
: 0   False      3
: 1    True    197
: None

** Рассмотрим связи

#+begin_src python :results output :exports both :session s1
# test_users_atten = np.intersect1d(dft.users_id,dfa.users_id)
att = dfa[dfa['users_id'].isin(dft['users_id'])]
gr = dfg[dfg.id.isin(dfa.group_id)]
print(att)
print()
count_fkey(dfa.group_id, dfg.id)
print()
print(gr)
# at_g = dfa[dfa['test_users_atten
# print(count_fkey(test_users_atten, dfg.id))
#+end_src

#+RESULTS:
#+begin_example
         unknown_id   group_id   users_id                         dict2  ...  o1f        date  time_beg  time_end
171       401346563  801346563  101420886  ОНЛАЙН Интеллектуальные игры  ...   Да  2022-08-01  09:00:00  10:00:00
325       401346576  801346576  101399902          Скандинавская ходьба  ...  Нет  2022-08-01  10:00:00  11:00:00
507       401346597  801346597  101360201     ОНЛАЙН Московский театрал  ...   Да  2022-08-01  10:00:00  12:00:00
572       401346609  801346609  101402753                    Гимнастика  ...  Нет  2022-08-01  09:00:00  10:00:00
609       401346615  801346615  101402753     Информационные технологии  ...  Нет  2022-08-01  11:30:00  12:30:00
...             ...        ...        ...                           ...  ...  ...         ...       ...       ...
5901150   402103127  801348474  101385158           ОНЛАЙН Здорово жить  ...   Да  2023-01-31  15:00:00  16:00:00
5901176   402103129  801352229  101364451     Информационные технологии  ...  Нет  2023-01-31  14:30:00  15:30:00
5901178   402103129  801352229  101424777     Информационные технологии  ...  Нет  2023-01-31  14:30:00  15:30:00
5901192   402103130  801370061  101347269         ОНЛАЙН Пеший лекторий  ...   Да  2023-01-09  08:00:00  10:00:00
5901249   402103132  801371145  101385582         ОНЛАЙН Пеший лекторий  ...   Да  2023-01-31  12:30:00  14:30:00

[55966 rows x 9 columns]

Unique [group_id]: 24535
Unique [id]: 27003
   values  count
0    True  24535

              id                  dict1  ...                                        shed_closed shed_plan
0      801357270  Физическая активность  ...  c 01.01.2023 по 31.03.2023, Пн., Ср. 19:10-20:...       NaN
1      801356857  Физическая активность  ...  c 09.01.2023 по 31.03.2023, Вт., Чт. 10:00-11:...       NaN
2      801351684  Физическая активность  ...  c 09.01.2023 по 31.03.2023, Вт., Чт. 19:00-20:...       NaN
3      801353683  Физическая активность  ...  c 09.01.2023 по 31.03.2023, Пн., Ср. 13:30-14:...       NaN
4      801352164  Физическая активность  ...  c 10.01.2023 по 28.02.2023, Вт., Пт. 12:00-13:...       NaN
...          ...                    ...  ...                                                ...       ...
26505  801365712                  Танцы  ...                                                NaN       NaN
26506  801373608  Физическая активность  ...  c 28.02.2023 по 28.02.2023, Вт. 10:30-11:30, б...       NaN
26565  801364212  Физическая активность  ...  c 28.02.2023 по 31.03.2023, Вт., Чт. 12:00-13:...       NaN
26612  801373703  Физическая активность  ...  c 28.02.2023 по 28.02.2023, Вт. 10:00-11:00, б...       NaN
26613  801373699                  Танцы  ...  c 28.02.2023 по 28.02.2023, Вт. 12:00-13:00, б...       NaN

[24535 rows x 10 columns]
#+end_example

Посчитаем количество atten для каждого пользователя

#+begin_src python :results file graphics :exports both :file ./autoimgs/test_att_hist.png :session s1
import matplotlib.pyplot as plt
f = att.groupby(['users_id'])['users_id'].count()
f.hist(bins=30)
plt.xlabel('count of attend')
plt.ylabel('users')
plt.savefig('./autoimgs/test_att_hist.png')
# plt.show()
plt.close()
#+end_src

#+RESULTS:
[[file:./autoimgs/test_att_hist.png]]

Посчитаем количество групп для каждого пользователя

#+begin_src python :results file graphics :exports both :file ./autoimgs/test_group_hist.png :session s1
import matplotlib.pyplot as plt
att = dfa[dfa['users_id'].isin(dft['users_id'])]
f = att.groupby(['users_id','group_id']).count().groupby(['users_id'])['unknown_id'].count()
f.hist(bins=40)
plt.xlabel('count of attend')
plt.ylabel('users')
plt.savefig('./autoimgs/test_group_hist.png')
# plt.show()
plt.close()
#+end_src

#+RESULTS:
[[file:./autoimgs/test_group_hist.png]]

* attend->(groups, users)
Впоросы
1. как много человев не участвует в посещениях
2. сколько человек участвует в 2 3 4 5 и более посещений
3. сколько человек находится в скольки группах
4. сколько человек находится в скольки направлениях

Ответы:
1. Почти все из 52334 кроме 1428.
2. 4-5 тысяч, c 2 больше всего
3. в основном в 2 и далее по убывающей
4.

** load
#+begin_src python :results output :exports both :session s1
import numpy as np
import pandas as pd

import numpy as np
import pandas as pd

p = '/home/u/proj_dolgoletie/attend.csv'
dfa = pd.read_csv(p, header=0, index_col=False, low_memory=True,
                  names=['unknown_id', 'group_id', 'users_id', 'dict2', 'dict3', 'o1f', 'date', 'time_beg', 'time_end'])
p = '/home/u/proj_dolgoletie/groups.csv'
dfg = pd.read_csv(p, header=0, index_col=False, low_memory=False,
                  names=['id', 'dict1', 'dict2', 'dict3', 'p_addr', 'p_okr', 'p_ra', 'shed_act', 'shed_closed', 'shed_plan'])
p = '/home/u/proj_dolgoletie/users.csv'
dfu = pd.read_csv(p, header=0, index_col=False, low_memory=False,
                  names=['id', 'created', 'gender', 'birthday', 'address'])
def count_fkey(key1, key2):
    "we get unique of key1 and compare with all key2
    whether each element of a 1-D array is also present in a second array."
    un1 = np.unique(key1)
    # un2 = np.unique(key2)
    un2 = key2
    cm = np.in1d(un1, un2, assume_unique=True)
    if 'name' in dir(key1):
        print(f"Unique [{key1.name}]: { un1.size}")
        print(f"Unique [{key2.name}]: { un2.size}")
    else:
        print(f"key1: { un1.size}")
        print(f"key2: { un2.size}")
    c = np.unique(cm, return_counts=True)
    print(pd.DataFrame({'values':c[0], 'count':c[1]}))

#+end_src

#+RESULTS:

** attend -> group
#+begin_src python :results output :exports both :session s1
cm = np.in1d(dfa.group_id.unique(), dfg.id.unique(), assume_unique=True)
c = np.unique(cm, return_counts=True)
print(c[0])
print(c[1])
#+end_src

#+RESULTS:
: [False  True]
: [  1 116]

** attend -> users
#+begin_src python :results output :exports both :session s1
cm = np.in1d(dfa.users_id.unique(), dfu.id.unique(), assume_unique=True)
c = np.unique(cm, return_counts=True)
print(c[0])
print(c[1])
#+end_src

#+RESULTS:
: [False  True]
: [  1 940]

** Рассмотрим связи
1428 users из 52334 нет в atten

2468 групп из 27003 нeт в atten

Больше всего пользователей с 2 группами

Все пользователи хотя бы в одной группе
#+begin_src python :results output :exports both :session s1
count_fkey(dfu.id, dfa.users_id)
count_fkey(dfa.users_id, dfu.id)
print()
count_fkey(dfg.id, dfa.group_id)
count_fkey(dfa.group_id, dfg.id)
#+end_src

#+RESULTS:
#+begin_example
Unique [id]: 52334
Unique [users_id]: 5901274
   values  count
0   False   1428
1    True  50906
Unique [users_id]: 50906
Unique [id]: 52334
   values  count
0    True  50906

Unique [id]: 27003
Unique [group_id]: 5901274
   values  count
0   False   2468
1    True  24535
Unique [group_id]: 24535
Unique [id]: 27003
   values  count
0    True  24535
#+end_example

Посчитаем количество atten для каждого пользователя

#+begin_src python :results file graphics :exports both :file ./autoimgs/all_att_hist.png :session s1
import matplotlib.pyplot as plt
att = dfa[dfa['users_id'].isin(dfu['id'])]
f = att.groupby(['users_id'])['users_id'].count()
f.hist(bins=100)
plt.xlabel('count of attend')
plt.ylabel('users')
plt.savefig('./autoimgs/all_att_hist.png')
# plt.show()
plt.close()
#+end_src

#+RESULTS:
[[file:./autoimgs/test_att_hist.png]]

Посчитаем количество групп для каждого пользователя

#+begin_src python :results file graphics :exports both :file ./autoimgs/all_group_hist.png :session s1
import matplotlib.pyplot as plt
att = dfa[dfa['users_id'].isin(dfu['id'])]
f = att.groupby(['users_id','group_id']).count().groupby(['users_id'])['unknown_id'].count()
f = f[f<50]
f.hist(bins=50)
plt.xlabel('count of groups')
plt.ylabel('users')
plt.savefig('./autoimgs/all_group_hist.png')
plt.show()
# plt.close()
#+end_src

#+RESULTS:
[[file:./autoimgs/all_group_hist.png]]

#+begin_src python :results output :exports both :session s1
f = att.groupby(['users_id','group_id']).count().groupby(['users_id'])['unknown_id'].count()
print(f[f == 0])
#+end_src

#+RESULTS:
: Series([], Name: unknown_id, dtype: int64)
